<!DOCTYPE html>
<html lang="en">

<head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>

  <div class="container-fluid p-2 my-2">
    <h1 class="display-4 text-dark text-center">Worker Asistan</h1>
  </div>
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm">
        <div class="row">
          <div class="col mt-2">
            <div class="col"><label>Makine Durumu: </label></div>
            <div class="col"><label id="state"><h4>Bilinmiyor</h4></label></div>
          </div>
        </div>
      </div>
      <div class="col-sm">
        <div class="row">
          <div class="col mt-2 text-center">
            <label id="productPart"><h4>Üretilecek Parça Seçilmedi</h4></label>
          </div>
        </div>
      </div>
      <div class="col-sm">
        <select class="form-select" id="selectMachine" onchange="selectMachine()">
        </select>
      </div>
    </div>

    <div class="row border-top border-1 border-secondary ">

      <div class="col-sm m-2">
        <div class="row mt-5" style="height: 3em;">
          <label for="workorder"><h4>Üretim Emri Seç</h4></label>
        </div>
        <div class="row mt-1" style="height: 3em;">
          <select class="form-select" id="selectOrder""></select>
        </div>
        <div class="row mt-1" style="height: 1em;">
          <button type="button"  onclick="setOrder()" class="btn btn-primary text-centertext-center ">
            <h1 class="h5">Üretim Emri Seç</h1>
          </button>
        </div>
      </div>

      <div class="col-sm">
        <div class="row mt-3">
          <div class="d-grid mt-2 h-100"><button style="height: 12em;" type="button" value="10000" onclick="girisYap(this.value)" class="btn btn-success btn-block text-centertext-center ">
            <h1 class="h1">Üretim Başlat</h1>
          </button></div>
        </div>
        
      </div>

      <div class="col-sm m-2">
        <div class="row mt-1" >
          <div class="col-sm"><label for ="target" ><h6> Hedef Parça</h6></label></div>
          <div class="col-sm"><label class="text-info" id="target" ><h3> 0 Adet </h3></label></div>
          
        </div>

        <div class="row mt-1">
          <div class="col-sm"><label for ="good" ><h6>Sağlam Parça Sayısı</h6></label></div>
          <div class="col-sm"><label class="text-success"" id="good" ><h3> 0 Adet </h3></label></div>
        </div>
        <div class="row mt-1" >
          <div class="col-sm"><label for ="reject" ><h6>Hurda/Fire Parça Sayısı</h6></label></div>
          <div class="col-sm"><label class="text-danger" id="reject" ><h3> 0 Adet </h3></label></div>
        </div>
        <div class="row mt-1" >
          <div class="col-sm">
            <button type="button" style="height: 5em;"" value="10000" onclick="girisYap(this.value)" class="btn btn-success text-centertext-center ">
              <h1 class="h5">Sağlam Parça</h1>
          </div>
          <div class="col-sm">
            <button type="button" style="height: 5em;"" value="10000" onclick="girisYap(this.value)" class="btn btn-danger text-centertext-center ">
              <h1 class="h5">Hurda/Fire Parça</h1>
          </div>
          <div class="col-sm">
            <button type="button" style="height: 5em;" value="10000" onclick="girisYap(this.value)" class="btn btn-warning text-centertext-center ">
              <h1 class="h5">Kayıt Et</h1>
          </div>
          
          </button>
        </div>
      </div>
    </div>

    <br>
    <div class="row border-top border-1 border-secondary bg-light bg-gradient" style="height: 10em">
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button" value="10000" onclick="girisYap(this.value)" class="btn btn-outline-primary btn-block text-centertext-center ">
            <h1 class="h1">Makine Çalışıyor</h1>
          </button></div>
      </div>
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button" value="150000" onclick="girisYap(this.value)" class="btn btn-outline-success btn-blocktext-center">
            <h1 class="h1">Mola</h1>
          </button></div>
      </div>
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button" value="100000" onclick="girisYap(this.value)" class="btn btn-outline-warning btn-blocktext-center">
            <h1 class="h1">Model Değişimi</h1>
          </button></div>
      </div>
    </div>
    <div class="row bg-light bg-gradient" style="height: 10em">
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button" value="220000" onclick="girisYap(this.value)" class="btn btn-outline-danger btn-blocktext-center ">
            <h1 class="h1">Arıza</h1>
          </button></div>
      </div>
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button" value="170000" onclick="girisYap(this.value)" class="btn btn-outline-danger btn-blocktext-center ">
            <h1 class="h1">Sipariş Yok</h1>
          </button></div>
      </div>
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button" value="90000" onclick="girisYap(this.value)" class="btn btn-outline-danger btn-blocktext-center ">
            <h1 class="h1">Hammadde Yok</h1>
          </button></div>
      </div>
    </div>
    <div class="row bg-light bg-gradient" style="height: 10em">
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button"
            class="btn btn-outline-primary btn-block text-centertext-center ">
            <h1 class="h1"></h1>
          </button></div>
      </div>
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button" value="30000" onclick="girisYap(this.value)" class="btn btn-outline-info btn-blocktext-center ">
            <h1 class="h1">Diğer</h1>
          </button></div>
      </div>
      <div class="col m-2">
        <div class="d-grid h-100"><button type="button" class="btn btn-outline-warning btn-blocktext-center ">
            <h1 class="h1"></h1>
          </button></div>
      </div>
    </div>
  </div>

</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
  var makine = ""
  var state = ""
  var status =""
  var orderList = []
  var selectOrderID = ""




  $( document ).ready(function() {
    listMachine();
  });

  
  function listMachine() {
    $.ajax({
            type: 'GET',
            url: 'http://192.168.10.226:1880/nodered/listMachine',
            success: function(result) {
              for (x=0; x<result.length; x++){
                console.log();
                item = document.getElementById("selectMachine");
                option = document.createElement("option");
                option.value = result[x];
                option.text = result[x];
                item.add(option);
              }
              option.value = "";
              option.text = "Makine Seçiniz";
              option.selected = "selected"
              item.add(option); 
            },
            complete: function (result) {
                    // Schedule the next
            }
    });
}

  function selectMachine(){
    makine = document.getElementById("selectMachine").value;
    console.log(makine)
    selectOrder(makine)
    doAjax();
  }

  function setState(state){
    document.getElementById('state').innerHTML = "<h4>" + state + "</h4>"
  }

  function setOrder(){
    x = document.getElementById('selectOrder').value
    //console.log(orderList)
    
    selectOrderText = orderList[x]["1"]
    selectOrderID = orderList[x]["0"]
    selectOrderTarget = orderList[x]["2"]
    
    document.getElementById('target').innerHTML = "<h3>" + selectOrderTarget + " Adet </h3>"
    document.getElementById('productPart').innerHTML = "<h3>" + selectOrderText + " Üretimine Aşağıdan Başlayabilirsin </h3>"
  }

  function selectOrder(makine) {
    $.ajax({
            type: 'GET',
            url: 'http://192.168.10.226:1880/nodered/orderSelectbyMachine',
            data: {
              "machine" : makine,
            },
            dataType: 'json',
            success: function(result) {
              for (x=0; x<=result.length; x++){
                console.log(result[x]);
                item = document.getElementById("selectOrder");
                option = document.createElement("option");
                option.value = x;
                option.text = result[x]["1"];
                item.add(option);
                orderList.push(result[x])
              }
              option.value = "";
              option.text = "Üretim Emri Seçiniz";
              option.selected = "selected"
              item.add(option);
              orderList = result 
            },
            complete: function (result) {
                    // Schedule the next
            }
    });    
}


  function girisYap(param1) {
    status = param1;
    //console.log(deger1)
  }


  function doAjax() {
      $.ajax({
            type: 'GET',
            url: 'http://192.168.10.226:1880/nodered/checkMachineState',
            data: {
              "machine" : makine,
            },
            dataType: 'json',
            success: function(result) {
                    //console.log(result)
                    setState(result["state"])  
            },
            complete: function (result) {
                    // Schedule the next
                    setTimeout(doAjax, 3000);
            }
    });    
}
setTimeout(doAjax, 3000);
</script>
</html>
